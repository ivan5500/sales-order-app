"use strict";(self.webpackChunksales_order_app=self.webpackChunksales_order_app||[]).push([[348],{4348:(V,v,a)=>{a.r(v),a.d(v,{AddOrderPageModule:()=>P});var u=a(6814),Z=a(6889),p=a(1896),t=a(5879),o=a(6223),d=a(7700);function b(e){return e.value&&""===e.value.trim()?{noEspacios:!0}:null}let I=(()=>{class e{constructor(){}isValidField(r,n){return r.controls[n].errors&&r.controls[n].touched}static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var l=a(9157),_=a(2032),f=a(2296);function A(e,m){1&e&&(t.TgZ(0,"span",11),t._uU(1,"Required field"),t.qZA())}function F(e,m){1&e&&(t.TgZ(0,"span",11),t._uU(1,"Required numeric field (max 2 decimals)"),t.qZA())}function C(e,m){1&e&&(t.TgZ(0,"span",11),t._uU(1,"Required numeric field"),t.qZA())}let T=(()=>{class e{get newItem(){return this.itemForm.value}constructor(r){this._validationService=r,this.addItemEvent=new t.vpe,this.cancelAddEvent=new t.vpe,this.pricePatter=/^\d+(\.\d{2})?$/,this.quantityPatter="^[0-9]*$",this.itemForm=new o.cw({name:new o.NI("",[o.kI.required,b,o.kI.maxLength(250)]),price:new o.NI(null,[o.kI.required,o.kI.pattern(this.pricePatter)]),quantity:new o.NI(null,[o.kI.required,o.kI.pattern(this.quantityPatter)])})}onSubmit(){this.itemForm.invalid||(this.addItemEvent.emit(this.newItem),console.log(this.newItem))}onCancel(){this.itemForm.reset(),this.cancelAddEvent.emit(!0)}isValidField(r){return this._validationService.isValidField(this.itemForm,r)}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(I))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["sales-order-item-form"]],outputs:{addItemEvent:"addItemEvent",cancelAddEvent:"cancelAddEvent"},decls:23,vars:5,consts:[[3,"formGroup","ngSubmit"],[1,"w-100"],["matInput","","formControlName","name"],["class","form-text text-danger",4,"ngIf"],["type","number","matInput","","formControlName","price"],["type","number","matInput","","formControlName","quantity"],[1,"row"],[1,"col"],["mat-stroked-button","","type","button","color","primary",3,"click"],["id","btn-submit",1,"col"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"form-text","text-danger"]],template:function(n,i){1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.TgZ(1,"mat-form-field",1)(2,"mat-label"),t._uU(3,"Name"),t.qZA(),t._UZ(4,"input",2),t.YNc(5,A,2,0,"span",3),t.qZA(),t.TgZ(6,"mat-form-field",1)(7,"mat-label"),t._uU(8,"Price"),t.qZA(),t._UZ(9,"input",4),t.YNc(10,F,2,0,"span",3),t.qZA(),t.TgZ(11,"mat-form-field",1)(12,"mat-label"),t._uU(13,"Quantity"),t.qZA(),t._UZ(14,"input",5),t.YNc(15,C,2,0,"span",3),t.qZA(),t.TgZ(16,"div",6)(17,"div",7)(18,"button",8),t.NdJ("click",function(){return i.onCancel()}),t._uU(19," Cancel "),t.qZA()(),t.TgZ(20,"div",9)(21,"button",10),t._uU(22," Save "),t.qZA()()()()),2&n&&(t.Q6J("formGroup",i.itemForm),t.xp6(5),t.Q6J("ngIf",i.isValidField("name")),t.xp6(5),t.Q6J("ngIf",i.isValidField("price")),t.xp6(5),t.Q6J("ngIf",i.isValidField("quantity")),t.xp6(6),t.Q6J("disabled",!i.itemForm.valid))},dependencies:[u.O5,l.KE,l.hX,_.Nt,f.lW,o._Y,o.Fj,o.wV,o.JJ,o.JL,o.sg,o.u],styles:["#btn-submit[_ngcontent-%COMP%]{text-align:right}"]})}return e})(),q=(()=>{class e{onAddItem(r){console.log(r),this.dialogRef.close(r)}constructor(r,n){this.dialogRef=r,this.data=n}onCancelAdd(r){this.dialogRef.close()}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(d.so),t.Y36(d.WI))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-dialog-add"]],decls:4,vars:0,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"addItemEvent","cancelAddEvent"]],template:function(n,i){1&n&&(t.TgZ(0,"h1",0),t._uU(1,"Add Item"),t.qZA(),t.TgZ(2,"div",1)(3,"sales-order-item-form",2),t.NdJ("addItemEvent",function(c){return i.onAddItem(c)})("cancelAddEvent",function(c){return i.onCancelAdd(c)}),t.qZA()())},dependencies:[d.uh,d.xY,T]})}return e})();const h=.16;var y=a(2202);let w=(()=>{class e{constructor(){}getSubtotal(r){return r.reduce((i,s)=>i+s.price*s.quantity,0)}getTotal(r,n){return this.getSubtotal(r)*n+this.getSubtotal(r)}static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var g=a(8034),N=a(1175),O=a(421);function U(e,m){1&e&&(t.TgZ(0,"span",19),t._uU(1,"Required field"),t.qZA())}function S(e,m){1&e&&(t.TgZ(0,"span",19),t._uU(1,"Add at least one item"),t.qZA())}function J(e,m){if(1&e&&t._UZ(0,"sales-order-item-table",20),2&e){const r=t.oxw();t.Q6J("items",r.items)}}let E=(()=>{class e{get newOrder(){const r=this.orderForm.value;return r.creationDate=new Date,r.subtotal=this.orderForm.controls.subtotal.value,r.vat=h,r.total=this.orderForm.controls.total.value,r}constructor(r,n,i,s,c){this._router=r,this._salesOrderService=n,this.dialog=i,this._itemService=s,this._validationService=c,this.addOrderEvent=new t.vpe,this.cancelAddEvent=new t.vpe,this.items=[],this.total=0,this.subtotal=0,this._redirectPath="./list",this.orderForm=new o.cw({id:new o.NI({value:"",disabled:!0}),customer:new o.NI("",[o.kI.required,b,o.kI.maxLength(250)]),creationDate:new o.NI({value:new Date,disabled:!0},[o.kI.required]),subtotal:new o.NI({value:0,disabled:!0},[o.kI.required]),vat:new o.NI({value:h,disabled:!0},[o.kI.required]),total:new o.NI({value:0,disabled:!0},[o.kI.required]),items:new o.NI(this.items,[o.kI.required])})}onSubmit(){this.orderForm.invalid||(this.addOrderEvent.emit(this.newOrder),this._salesOrderService.addOrder(this.newOrder),this.orderForm.reset(),this.orderForm.controls.creationDate.setValue(new Date),this.items=[],this._router.navigate([this._redirectPath]))}onCancel(){this.orderForm.reset(),this.cancelAddEvent.emit(!0),this._router.navigate([".."])}openDialog(){this.dialog.open(q,{data:{}}).afterClosed().subscribe(n=>{n&&this._addItem(n)})}_addItem(r){this.items=[r,...this.items],this.orderForm.controls.items.setValue(this.items);const n=this._itemService.getTotal(this.items,h),i=this._itemService.getSubtotal(this.items);this.orderForm.controls.total.setValue(n),this.orderForm.controls.subtotal.setValue(i)}isValidField(r){return this._validationService.isValidField(this.orderForm,r)}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(p.F0),t.Y36(y.V),t.Y36(d.uw),t.Y36(w),t.Y36(I))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["sales-order-form"]],outputs:{addOrderEvent:"addOrderEvent",cancelAddEvent:"cancelAddEvent"},decls:42,vars:7,consts:[[3,"formGroup","ngSubmit"],[1,"w-100"],["matInput","","formControlName","customer"],["class","form-text text-danger",4,"ngIf"],["matInput","","formControlName","creationDate",3,"matDatepicker"],["matIconSuffix","",3,"for"],["picker",""],[1,"row","mb-2"],[1,"col"],["id","add-btn",1,"col"],["type","button","mat-mini-fab","","color","accent","aria-label","Add Item",3,"click"],[3,"items",4,"ngIf"],["matInput","","formControlName","subtotal"],["matInput","","formControlName","vat"],["matInput","","formControlName","total"],[1,"row"],["mat-stroked-button","","color","primary","type","button",3,"click"],["id","btn-submit",1,"col"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"form-text","text-danger"],[3,"items"]],template:function(n,i){if(1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.TgZ(1,"mat-form-field",1)(2,"mat-label"),t._uU(3,"Customer"),t.qZA(),t._UZ(4,"input",2),t.YNc(5,U,2,0,"span",3),t.qZA(),t.TgZ(6,"mat-form-field",1)(7,"mat-label"),t._uU(8,"Creation Date"),t.qZA(),t._UZ(9,"input",4)(10,"mat-datepicker-toggle",5)(11,"mat-datepicker",null,6),t.qZA(),t.TgZ(13,"div",7)(14,"div",8)(15,"h4"),t._uU(16,"Items*"),t.qZA()(),t.TgZ(17,"div",9)(18,"button",10),t.NdJ("click",function(){return i.openDialog()}),t.TgZ(19,"mat-icon"),t._uU(20,"add"),t.qZA()()()(),t.YNc(21,S,2,0,"span",3),t.YNc(22,J,1,1,"sales-order-item-table",11),t.TgZ(23,"mat-form-field",1)(24,"mat-label"),t._uU(25,"Subtotal"),t.qZA(),t._UZ(26,"input",12),t.qZA(),t.TgZ(27,"mat-form-field",1)(28,"mat-label"),t._uU(29,"VAT"),t.qZA(),t._UZ(30,"input",13),t.qZA(),t.TgZ(31,"mat-form-field",1)(32,"mat-label"),t._uU(33,"Total"),t.qZA(),t._UZ(34,"input",14),t.qZA(),t.TgZ(35,"div",15)(36,"div",8)(37,"button",16),t.NdJ("click",function(){return i.onCancel()}),t._uU(38," Cancel "),t.qZA()(),t.TgZ(39,"div",17)(40,"button",18),t._uU(41," Save "),t.qZA()()()()),2&n){const s=t.MAs(12);t.Q6J("formGroup",i.orderForm),t.xp6(5),t.Q6J("ngIf",i.isValidField("customer")),t.xp6(4),t.Q6J("matDatepicker",s),t.xp6(1),t.Q6J("for",s),t.xp6(11),t.Q6J("ngIf",!i.items.length),t.xp6(1),t.Q6J("ngIf",i.items.length),t.xp6(18),t.Q6J("disabled",!i.orderForm.valid)}},dependencies:[u.O5,g.Mq,g.hl,g.nW,l.KE,l.hX,l.R9,_.Nt,f.lW,f.nh,N.Hw,o._Y,o.Fj,o.JJ,o.JL,o.sg,o.u,O.E],styles:["#btn-submit[_ngcontent-%COMP%], #add-btn[_ngcontent-%COMP%]{text-align:right}#item-table[_ngcontent-%COMP%]{height:270px}"]})}return e})();const k=[{path:"",component:(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-add-order-page"]],decls:7,vars:0,consts:[[1,"container"],[1,"row","text-center"],[1,"row","justify-content-center"],[1,"col-sm-12","col-md-6"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1"),t._uU(3,"Create Sale Order"),t.qZA()(),t.TgZ(4,"div",2)(5,"div",3),t._UZ(6,"sales-order-form"),t.qZA()()())},dependencies:[E]})}return e})()},{path:"**",redirectTo:""}];let x=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=t.oAB({type:e});static#r=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(k),p.Bz]})}return e})();var Y=a(1363);let P=(()=>{class e{static#t=this.\u0275fac=function(n){return new(n||e)};static#e=this.\u0275mod=t.oAB({type:e});static#r=this.\u0275inj=t.cJS({imports:[u.ez,x,Z.q,o.UX,Y.O]})}return e})()}}]);